<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SentinelScope Report — {{ result.domain }}</title>
  <meta name="robots" content="noindex" />
  <style>
    /* Minimal, programmer-friendly layout */
    :root {
      --fg:#111827; --bg:#ffffff; --muted:#6b7280; --line:#e5e7eb;
    }
    @media (prefers-color-scheme: dark) {
      :root { --fg:#e5e7eb; --bg:#0b1020; --muted:#9aa4b2; --line:#1f2937; }
    }
    html, body { margin:0; padding:0; background:var(--bg); color:var(--fg); }
    body { font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, "Liberation Mono", monospace; font-size:14px; line-height:1.5; }
    .wrap { max-width: 960px; margin: 0 auto; padding: 16px; }
    h1, h2, h3 { margin: 0 0 6px; font-weight: 700; }
    h1 { font-size: 18px; }
    h2 { font-size: 16px; margin-top: 14px; }
    h3 { font-size: 14px; margin-top: 10px; }
    .muted { color: var(--muted); }
    .sep { height:1px; background: var(--line); margin: 10px 0; }
    .block { padding: 8px 0; }
    .kv { display: grid; grid-template-columns: 180px 1fr; gap: 8px 16px; }
    .kv div { padding: 2px 0; }
    table { width:100%; border-collapse: collapse; }
    th, td { border:1px solid var(--line); padding:6px 8px; vertical-align: top; text-align:left; }
    .small { font-size: 12px; }
    ul { margin: 6px 0; }
    code { background: rgba(125,125,125,.08); padding: 1px 4px; border-radius: 3px; }
    .mono { font-family: inherit; }
    details summary { cursor: pointer; }
  </style>
</head>
<body>
  <div class="wrap">
    <h1>SentinelScope Report — {{ result.domain }}</h1>
    <div class="small muted">Started: {{ result.started_at }} | Finished: {{ result.finished_at }}</div>
    <div class="sep"></div>

    <div class="block">
      <h2>Overview</h2>
      <div class="kv">
        <div>Headers grade</div>
        <div>
          {% if result.headers %}
            {{ result.headers.grade }}{% if result.headers.grade != 'N/A' %} ({{ result.headers.score }}%){% endif %}
          {% else %}n/a{% endif %}
        </div>
        <div>Summary</div>
        <div class="small muted">
          Grades reflect the presence and quality of core browser protections (CSP, HSTS, etc.).
          Public sites should aim for A. Auth/PII/payment flows should target A+.
          Some findings are judgement calls; use context and threat model.
        </div>
        <div>TLS protocol</div>
        <div>{{ result.tls.protocol if result.tls and result.tls.protocol else 'n/a' }}</div>
        <div>Open ports</div>
        <div>{{ result.ports.open_ports|length if result.ports else 0 }}</div>
        <div>Subdomains</div>
        <div>{{ result.subdomains.discovered|length if result.subdomains else 0 }}</div>
        <div>SPF / DMARC</div>
        <div>
          {% if result.dns %}
            SPF: {{ 'present' if result.dns.spf_present else 'missing' }} | DMARC: {{ result.dns.dmarc_policy if result.dns.dmarc_present else 'missing' }}
          {% else %}n/a{% endif %}
        </div>
      </div>
    </div>

    <div class="sep"></div>

    <div class="block" id="headers">
      <h2>Security headers</h2>
      <div class="small muted">Browsers use these headers to block common attacks. "Improve" suggests safer defaults.</div>
      {% if result.headers %}
        <div class="kv" style="margin:6px 0 8px;">
          <div>Grade / Score</div><div>{{ result.headers.grade }} / {{ result.headers.score }}</div>
        </div>
        <table class="mono">
          <thead><tr><th>Header</th><th>Status</th><th>Recommendation</th></tr></thead>
          <tbody>
            {% for f in result.headers.findings %}
            <tr>
              <td>{{ f.header }}</td>
              <td>
                {% if f.present and not f.recommendation %}Present
                {% elif f.present and f.recommendation %}Improve
                {% else %}Missing{% endif %}
              </td>
              <td class="small">{{ f.recommendation or '' }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      {% else %}
        <div class="small muted">No header analysis.</div>
      {% endif %}
    </div>

    <div class="block" id="tls">
      <h2>TLS (HTTPS)</h2>
      {% if result.tls %}
      <table class="mono">
        <tbody>
          <tr><td>Protocol</td><td>{{ result.tls.protocol or 'n/a' }}</td></tr>
          <tr><td>Valid from</td><td>{{ result.tls.valid_from or 'n/a' }}</td></tr>
          <tr><td>Valid to</td><td>{{ result.tls.valid_to or 'n/a' }}</td></tr>
          <tr><td>Days until expiry</td><td>{{ result.tls.days_until_expiry if result.tls.days_until_expiry is not none else 'n/a' }}</td></tr>
          <tr><td>Subject</td><td class="small">{{ result.tls.subject or {} }}</td></tr>
          <tr><td>Issuer</td><td class="small">{{ result.tls.issuer or {} }}</td></tr>
          {% if result.tls.warnings %}
          <tr><td>Warnings</td><td>
            <ul class="small">{% for w in result.tls.warnings %}<li>{{ w }}</li>{% endfor %}</ul>
          </td></tr>
          {% endif %}
        </tbody>
      </table>
      {% else %}
        <div class="small muted">No TLS info.</div>
      {% endif %}
    </div>

    <div class="block" id="ports">
      <h2>Open ports</h2>
      {% if result.ports %}
        <div class="small muted">{{ result.ports.open_ports|length }} open · scanned {{ result.ports.ports_scanned|length }} ports</div>
        <div class="small">Open: {% if result.ports.open_ports %}<code>{{ result.ports.open_ports | join(', ') }}</code>{% else %}<span class="muted">none</span>{% endif %}</div>
        <details>
          <summary class="small">View full results (all scanned ports)</summary>
          <div style="margin-top:8px;">
            <table class="mono">
              <thead><tr><th>Port</th><th>Status</th></tr></thead>
              <tbody>
                {% for r in result.ports.results %}
                <tr><td>{{ r.port }}</td><td>{% if r.is_open %}Open{% else %}Closed{% endif %}</td></tr>
                {% endfor %}
              </tbody>
            </table>
          </div>
        </details>
      {% else %}
        <div class="small muted">No port scan.</div>
      {% endif %}
    </div>

    <div class="block" id="dns">
      <h2>DNS and email policies</h2>
      {% if result.dns %}
        <table class="mono">
          <tbody>
            <tr><td>A</td><td class="small">{{ result.dns.a_records }}</td></tr>
            {% if result.dns.aaaa_records %}<tr><td>AAAA</td><td class="small">{{ result.dns.aaaa_records }}</td></tr>{% endif %}
            {% if result.dns.mx_records %}<tr><td>MX</td><td class="small">{{ result.dns.mx_records }}</td></tr>{% endif %}
            <tr><td>SPF</td><td>{{ 'present' if result.dns.spf_present else 'missing' }} ({{ result.dns.spf_policy or 'n/a' }}){% if result.dns.spf_recommendation %} — <span class="small">{{ result.dns.spf_recommendation }}</span>{% endif %}</td></tr>
            <tr><td>DMARC</td><td>{{ 'present' if result.dns.dmarc_present else 'missing' }} ({{ result.dns.dmarc_policy or 'n/a' }}){% if result.dns.dmarc_recommendation %} — <span class="small">{{ result.dns.dmarc_recommendation }}</span>{% endif %}</td></tr>
          </tbody>
        </table>
      {% else %}
        <div class="small muted">No DNS info.</div>
      {% endif %}
    </div>

    <div class="block" id="axfr">
      <h2>Zone transfer (AXFR)</h2>
      {% if result.dns_axfr %}
        <div class="small muted">Authoritative NS checked: {{ result.dns_axfr.attempted_ns }}</div>
        <div>{% if result.dns_axfr.axfr_allowed_on %}AXFR allowed on: {{ result.dns_axfr.axfr_allowed_on }}{% else %}AXFR not allowed{% endif %}</div>
      {% else %}
        <div class="small muted">Not checked.</div>
      {% endif %}
    </div>

    <div class="block" id="dnsx">
      <h2>DNS extras</h2>
      {% if result.dns_extras %}
        <div>DNSSEC: {{ 'present' if result.dns_extras.dnssec_present else 'absent' }}</div>
        {% if result.dns_extras.caa_records %}<div class="small">CAA: {{ result.dns_extras.caa_records }}</div>{% endif %}
      {% else %}
        <div class="small muted">Not checked.</div>
      {% endif %}
    </div>

    <div class="block" id="web">
      <h2>Web insights</h2>
      {% if result.preview %}
        <div class="small muted">Effective URL: {{ result.preview.url or 'n/a' }} | Status: {{ result.preview.status_code or 'n/a' }} | Server: {{ result.preview.server or 'n/a' }} | Type: {{ result.preview.content_type or 'n/a' }}</div>
      {% endif %}
      <div class="block">
        {% if result.cors %}
          <h3>CORS</h3>
          <table class="mono"><tbody>
            <tr><td>allow-origin</td><td>{{ result.cors.allow_origin or 'n/a' }}</td></tr>
            <tr><td>allow-credentials</td><td>{{ result.cors.allow_credentials if result.cors.allow_credentials is not none else 'n/a' }}</td></tr>
            {% if result.cors.risks %}<tr><td>risks</td><td class="small"><ul>{% for r in result.cors.risks %}<li>{{ r }}</li>{% endfor %}</ul></td></tr>{% endif %}
          </tbody></table>
        {% endif %}
        {% if result.cookies and result.cookies.cookies %}
          <h3>Cookies</h3>
          <table class="mono">
            <thead><tr><th>Name</th><th>Secure</th><th>HttpOnly</th><th>SameSite</th><th>Issues</th></tr></thead>
            <tbody>
              {% for c in result.cookies.cookies %}
              <tr>
                <td>{{ c.name }}</td>
                <td>{{ 'yes' if c.secure else 'no' }}</td>
                <td>{{ 'yes' if c.http_only else 'no' }}</td>
                <td>{{ c.same_site or 'n/a' }}</td>
                <td class="small">{{ ', '.join(c.issues) if c.issues else '' }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        {% endif %}
        {% if result.web_fingerprint %}
          <h3>Fingerprint</h3>
          <table class="mono"><tbody>
            <tr><td>Server</td><td>{{ result.web_fingerprint.server or 'n/a' }}</td></tr>
            <tr><td>WAF/CDN</td><td>{{ result.web_fingerprint.waf_or_cdn or 'n/a' }}</td></tr>
            {% if result.web_fingerprint.technologies %}<tr><td>Technologies</td><td class="small">{{ result.web_fingerprint.technologies }}</td></tr>{% endif %}
          </tbody></table>
        {% endif %}
        {% if result.mixed_content %}
          <h3>Mixed content</h3>
          <table class="mono"><tbody>
            <tr><td>Insecure references</td><td>{{ result.mixed_content.insecure_reference_count }}</td></tr>
            {% if result.mixed_content.examples %}<tr><td>Examples</td><td class="small"><ul>{% for ex in result.mixed_content.examples %}<li>{{ ex }}</li>{% endfor %}</ul></td></tr>{% endif %}
          </tbody></table>
        {% endif %}
        {% if result.security_txt %}
          <h3>security.txt</h3>
          {% if result.security_txt.found %}
            <div class="small">Found at <a href="{{ result.security_txt.url }}">{{ result.security_txt.url }}</a></div>
            {% if result.security_txt.contacts %}<div class="small">Contacts: {{ result.security_txt.contacts }}</div>{% endif %}
            {% if result.security_txt.policy %}<div class="small">Policy: <a href="{{ result.security_txt.policy }}">link</a></div>{% endif %}
            {% if result.security_txt.expires %}<div class="small">Expires: {{ result.security_txt.expires }}</div>{% endif %}
          {% else %}
            <div class="small muted">Not found.</div>
          {% endif %}
        {% endif %}
      </div>
    </div>

    <div class="block" id="subdomains">
      <h2>Subdomains</h2>
      {% if result.subdomains %}
        <div class="small muted">Sources: {{ result.subdomains.sources }}</div>
        {% if result.subdomains.discovered %}
        <ul class="mono">
          {% for s in result.subdomains.discovered %}<li>{{ s }}</li>{% endfor %}
        </ul>
        {% else %}
          <div class="small muted">None discovered.</div>
        {% endif %}
      {% else %}
        <div class="small muted">Not enumerated.</div>
      {% endif %}
    </div>

    <div class="block" id="takeover">
      <h2>Potential subdomain takeovers</h2>
      {% if result.takeover and result.takeover.flagged %}
        <div class="small">Flagged: {{ result.takeover.flagged|length }} / Checked: {{ result.takeover.checked_count }}</div>
        <ul>
          {% for f in result.takeover.flagged %}<li class="mono">{{ f.subdomain }} — {{ f.reason }}</li>{% endfor %}
        </ul>
      {% else %}
        <div class="small muted">No takeover signatures detected.</div>
      {% endif %}
    </div>

    <div class="sep"></div>
    <div class="small muted">Generated by SentinelScope</div>
  </div>
</body>
</html>
