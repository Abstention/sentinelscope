<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>SentinelScope Report – {{ result.domain }}</title>
  <meta name="description" content="Clean, readable security report for {{ result.domain }}" />
  <style>
    :root {
      --bg:#0f172a; --surface:#0b1220; --card:#111827; --border:#1f2937; --text:#e2e8f0; --muted:#94a3b8;
      --good:#10b981; --warn:#f59e0b; --bad:#ef4444; --accent:#3b82f6;
    }
    @media (prefers-color-scheme: light) {
      :root { --bg:#ffffff; --surface:#ffffff; --card:#f8fafc; --border:#e5e7eb; --text:#0f172a; --muted:#475569; }
    }
    html { scroll-behavior: smooth; }
    body { margin:0; background:var(--bg); color:var(--text); font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif; line-height: 1.6; }
    a { color: var(--accent); text-decoration: none; }
    a:hover { text-decoration: underline; }
    .wrap { max-width: 1100px; margin: 0 auto; padding: 20px; }
    .header { display:flex; align-items:center; justify-content:space-between; gap: 12px; padding: 12px 0; }
    .title { font-weight: 700; letter-spacing: .2px; margin: 0; font-size: 22px; }
    .meta { color: var(--muted); font-size: 14px; }
    .grid-2 { display:grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap:16px; }
    @media (max-width: 900px) { .grid-2 { grid-template-columns: 1fr; } }
    .card { background: var(--card); border:1px solid var(--border); border-radius: 14px; padding: 16px; }
    h2 { margin: 0 0 10px; font-size: 18px; letter-spacing: .2px; }
    h3 { margin: 0 0 8px; font-size: 16px; }
    .muted { color: var(--muted); }
    .pill { display:inline-block; background: rgba(148,163,184,.12); border:1px solid var(--border); padding:6px 10px; border-radius:999px; font-size: 13px; }
    .badge { display:inline-block; padding: 4px 10px; border-radius:999px; font-weight:700; font-size:12px; }
    .good { background:#065f46; color:#d1fae5; }
    .warn { background:#78350f; color:#ffedd5; }
    .bad  { background:#7f1d1d; color:#fee2e2; }
    .kvs { display:flex; gap:10px; flex-wrap:wrap; }
    .kvs .item { background: var(--surface); border:1px solid var(--border); border-radius:10px; padding:8px 10px; font-size: 14px; }
    table { width:100%; border-collapse: collapse; }
    th, td { border-bottom:1px solid var(--border); text-align:left; padding:10px 8px; vertical-align: top; }
    thead th { position: sticky; top: 0; background: var(--card); z-index: 1; }
    tr:nth-child(2n) td { background: rgba(148,163,184,.05); }
    .list { margin:0; padding-left: 18px; }
    .hr { height:1px; background: var(--border); margin: 14px 0; }
    /* Score ring */
    .ring { --p: 0; width: 120px; height: 120px; border-radius: 50%; background:
      conic-gradient(var(--good) calc(var(--p)*1%), rgba(148,163,184,.15) 0);
      display:grid; place-items:center; }
    .ring span { font-weight:700; }
  </style>
  <meta name="color-scheme" content="dark light" />
  <meta name="author" content="SentinelScope" />
  <meta name="robots" content="noindex" />
  <script>
    // No external deps; JS only to set score ring from inline data
    document.addEventListener('DOMContentLoaded', () => {
      const el = document.getElementById('scoreRing');
      if (!el) return;
      const score = Number(el.getAttribute('data-score') || '0');
      el.style.setProperty('--p', Math.max(0, Math.min(100, score)));
    });
  </script>
</head>
<body>
  <div class="wrap">
    <header class="header">
      <h1 class="title">SentinelScope Report</h1>
      <div class="meta">Target: <strong>{{ result.domain }}</strong> · Started: {{ result.started_at }} · Finished: {{ result.finished_at }}</div>
    </header>

    <section class="card">
      <div class="grid-2">
        <div style="display:flex; align-items:center; gap:16px;">
          {% if result.headers and result.headers.score is not none %}
          <div id="scoreRing" class="ring" data-score="{{ result.headers.score }}"><span>{{ result.headers.score }}%</span></div>
          {% else %}
          <div class="pill">No header score</div>
          {% endif %}
          <div>
            <div class="kvs">
              <div class="item">Headers grade: <strong>{{ result.headers.grade if result.headers else 'n/a' }}</strong></div>
              <div class="item">TLS: <strong>{{ result.tls.protocol if result.tls and result.tls.protocol else 'n/a' }}</strong></div>
              <div class="item">Open ports: <strong>{{ result.ports.open_ports|length if result.ports else 0 }}</strong></div>
              <div class="item">Subdomains: <strong>{{ result.subdomains.discovered|length if result.subdomains else 0 }}</strong></div>
            </div>
            <div class="hr"></div>
            <div class="kvs">
              <div class="item">SPF: <strong>{{ 'present' if result.dns and result.dns.spf_present else 'missing' }}</strong></div>
              <div class="item">DMARC: <strong>{{ result.dns.dmarc_policy if result.dns and result.dns.dmarc_present else 'missing' }}</strong></div>
              <div class="item">AXFR open NS: <strong>{{ result.dns_axfr.axfr_allowed_on|length if result.dns_axfr else 0 }}</strong></div>
            </div>
          </div>
        </div>
        <div>
          {% if result.preview %}
          <h3>Web preview</h3>
          <p>Status: <strong>{{ result.preview.status_code or 'n/a' }}</strong></p>
          <p>Title: <strong>{{ result.preview.title or 'n/a' }}</strong></p>
          <p class="muted">Server: {{ result.preview.server or 'n/a' }} · Type: {{ result.preview.content_type or 'n/a' }}</p>
          {% else %}
          <h3>Web preview</h3>
          <p class="muted">Not available</p>
          {% endif %}
        </div>
      </div>
    </section>

    <section class="grid-2">
      <div class="card">
        <h2>Security headers</h2>
        {% if result.headers %}
        <table>
          <thead><tr><th>Header</th><th>Status</th><th>Recommendation</th></tr></thead>
          <tbody>
            {% for f in result.headers.findings %}
            <tr>
              <td>{{ f.header }}</td>
              <td>
                {% if f.present and not f.recommendation %}<span class="badge good">Present</span>
                {% elif f.present and f.recommendation %}<span class="badge warn">Improve</span>
                {% else %}<span class="badge bad">Missing</span>{% endif %}
              </td>
              <td class="muted">{{ f.recommendation or '' }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
        {% else %}
        <p class="muted">No header analysis</p>
        {% endif %}
      </div>

      <div class="card">
        <h2>TLS</h2>
        {% if result.tls %}
          <p>Protocol: <strong>{{ result.tls.protocol or 'n/a' }}</strong></p>
          <p>Valid: <strong>{{ result.tls.valid_from or 'n/a' }}</strong> → <strong>{{ result.tls.valid_to or 'n/a' }}</strong> ({{ result.tls.days_until_expiry if result.tls.days_until_expiry is not none else 'n/a' }} days)</p>
          <p class="muted">Subject: {{ result.tls.subject or {} }} · Issuer: {{ result.tls.issuer or {} }}</p>
          {% if result.tls.warnings %}
          <p><span class="badge warn">{{ result.tls.warnings|length }} warning(s)</span></p>
          <ul class="list">
            {% for w in result.tls.warnings %}<li>{{ w }}</li>{% endfor %}
          </ul>
          {% endif %}
        {% else %}
          <p class="muted">No TLS info</p>
        {% endif %}
      </div>
    </section>

    <section class="grid-2">
      <div class="card">
        <h2>Open ports</h2>
        {% if result.ports %}
          {% if result.ports.open_ports %}
          <p class="muted">{{ result.ports.open_ports|length }} open · scanned {{ result.ports.ports_scanned|length }} ports</p>
          <table>
            <thead><tr><th>Port</th><th>Status</th></tr></thead>
            <tbody>
            {% for r in result.ports.results %}
              <tr>
                <td>{{ r.port }}</td>
                <td>{% if r.is_open %}<span class="badge warn">Open</span>{% else %}<span class="badge good">Closed</span>{% endif %}</td>
              </tr>
            {% endfor %}
            </tbody>
          </table>
          {% else %}
            <p><span class="badge good">No open common ports</span></p>
          {% endif %}
        {% else %}
          <p class="muted">No port scan</p>
        {% endif %}
      </div>

      <div class="card">
        <h2>DNS</h2>
        {% if result.dns %}
          <p><span class="muted">A:</span> {{ result.dns.a_records }}</p>
          {% if result.dns.aaaa_records %}<p><span class="muted">AAAA:</span> {{ result.dns.aaaa_records }}</p>{% endif %}
          {% if result.dns.mx_records %}<p><span class="muted">MX:</span> {{ result.dns.mx_records }}</p>{% endif %}
          <p><span class="muted">SPF:</span> {{ 'present' if result.dns.spf_present else 'missing' }} ({{ result.dns.spf_policy or 'n/a' }})</p>
          {% if result.dns.spf_recommendation %}<p class="muted">{{ result.dns.spf_recommendation }}</p>{% endif %}
          <p><span class="muted">DMARC:</span> {{ 'present' if result.dns.dmarc_present else 'missing' }} ({{ result.dns.dmarc_policy or 'n/a' }})</p>
          {% if result.dns.dmarc_recommendation %}<p class="muted">{{ result.dns.dmarc_recommendation }}</p>{% endif %}
        {% else %}
          <p class="muted">No DNS info</p>
        {% endif %}
        {% if result.dns_axfr %}
          <div class="hr"></div>
          <h3>Zone transfer (AXFR)</h3>
          <p class="muted">Authoritative NS checked: {{ result.dns_axfr.attempted_ns }}</p>
          {% if result.dns_axfr.axfr_allowed_on %}
            <p><span class="badge bad">AXFR allowed</span> on: {{ result.dns_axfr.axfr_allowed_on }}</p>
          {% else %}
            <p><span class="badge good">AXFR not allowed</span></p>
          {% endif %}
        {% endif %}
        {% if result.dns_extras %}
          <div class="hr"></div>
          <h3>Extras</h3>
          <p>DNSSEC: <strong>{{ 'present' if result.dns_extras.dnssec_present else 'absent' }}</strong></p>
          {% if result.dns_extras.caa_records %}
            <p class="muted">CAA: {{ result.dns_extras.caa_records }}</p>
          {% endif %}
        {% endif %}
      </div>
    </section>

    <section class="grid-2">
      <div class="card">
        <h2>Subdomains</h2>
        {% if result.subdomains %}
          <p class="muted">Sources: {{ result.subdomains.sources }}</p>
          {% if result.subdomains.discovered %}
            <ul class="list">
            {% for s in result.subdomains.discovered %}
              <li>{{ s }}</li>
            {% endfor %}
            </ul>
          {% else %}
            <p class="muted">None discovered</p>
          {% endif %}
        {% else %}
          <p class="muted">No subdomain enumeration</p>
        {% endif %}
      </div>

      <div class="card">
        <h2>Web insights</h2>
        {% if result.cors %}
          <h3>CORS</h3>
          <p>Allow-Origin: <strong>{{ result.cors.allow_origin or 'n/a' }}</strong> · Credentials: <strong>{{ result.cors.allow_credentials if result.cors.allow_credentials is not none else 'n/a' }}</strong></p>
          {% if result.cors.risks %}
          <ul class="list">
            {% for r in result.cors.risks %}<li>{{ r }}</li>{% endfor %}
          </ul>
          {% endif %}
        {% endif %}
        {% if result.cookies and result.cookies.cookies %}
          <div class="hr"></div>
          <h3>Cookies</h3>
          <table>
            <thead><tr><th>Name</th><th>Secure</th><th>HttpOnly</th><th>SameSite</th><th>Issues</th></tr></thead>
            <tbody>
              {% for c in result.cookies.cookies %}
              <tr>
                <td>{{ c.name }}</td>
                <td>{{ 'yes' if c.secure else 'no' }}</td>
                <td>{{ 'yes' if c.http_only else 'no' }}</td>
                <td>{{ c.same_site or 'n/a' }}</td>
                <td class="muted">{{ ', '.join(c.issues) if c.issues else '' }}</td>
              </tr>
              {% endfor %}
            </tbody>
          </table>
        {% endif %}
        {% if result.web_fingerprint %}
          <div class="hr"></div>
          <h3>Fingerprint</h3>
          <p>Server: <strong>{{ result.web_fingerprint.server or 'n/a' }}</strong> · WAF/CDN: <strong>{{ result.web_fingerprint.waf_or_cdn or 'n/a' }}</strong></p>
          {% if result.web_fingerprint.technologies %}
          <p class="muted">Tech: {{ result.web_fingerprint.technologies }}</p>
          {% endif %}
        {% endif %}
        {% if result.security_txt %}
          <div class="hr"></div>
          <h3>security.txt</h3>
          {% if result.security_txt.found %}
            <p class="muted"><a href="{{ result.security_txt.url }}">{{ result.security_txt.url }}</a></p>
            {% if result.security_txt.contacts %}<p>Contacts: {{ result.security_txt.contacts }}</p>{% endif %}
            {% if result.security_txt.policy %}<p>Policy: <a href="{{ result.security_txt.policy }}">link</a></p>{% endif %}
            {% if result.security_txt.expires %}<p>Expires: {{ result.security_txt.expires }}</p>{% endif %}
          {% else %}
            <p class="muted">Not found</p>
          {% endif %}
        {% endif %}
        {% if result.mixed_content %}
          <div class="hr"></div>
          <h3>Mixed content</h3>
          <p>Insecure references: <strong>{{ result.mixed_content.insecure_reference_count }}</strong></p>
          {% if result.mixed_content.examples %}
          <ul class="list">
            {% for ex in result.mixed_content.examples %}<li>{{ ex }}</li>{% endfor %}
          </ul>
          {% endif %}
        {% endif %}
      </div>
    </section>

    <section class="card">
      <h2>Potential subdomain takeovers</h2>
      {% if result.takeover and result.takeover.flagged %}
        <p><span class="badge warn">{{ result.takeover.flagged|length }} flagged</span> out of {{ result.takeover.checked_count }} checked</p>
        <ul class="list">
          {% for f in result.takeover.flagged %}
          <li>{{ f.subdomain }} — {{ f.reason }}</li>
          {% endfor %}
        </ul>
      {% else %}
        <p class="muted">No takeover signatures detected</p>
      {% endif %}
    </section>

    <footer class="muted" style="padding: 14px 0; font-size: 13px;">Generated by SentinelScope</footer>
  </div>
</body>
</html>

